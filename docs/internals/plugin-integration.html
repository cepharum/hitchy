<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Integrating Plugins | Hitchy Manual</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/core/assets/css/0.styles.9c038e3a.css" as="style"><link rel="preload" href="/core/assets/js/app.3fcfb5e6.js" as="script"><link rel="preload" href="/core/assets/js/2.e41aa8d4.js" as="script"><link rel="preload" href="/core/assets/js/12.90e933a5.js" as="script"><link rel="prefetch" href="/core/assets/js/10.9339cbea.js"><link rel="prefetch" href="/core/assets/js/11.9ac9b654.js"><link rel="prefetch" href="/core/assets/js/13.82bed34b.js"><link rel="prefetch" href="/core/assets/js/14.84194869.js"><link rel="prefetch" href="/core/assets/js/15.1eb4d3ff.js"><link rel="prefetch" href="/core/assets/js/16.bfadbd20.js"><link rel="prefetch" href="/core/assets/js/17.58dd16dd.js"><link rel="prefetch" href="/core/assets/js/18.b4dd4c68.js"><link rel="prefetch" href="/core/assets/js/3.a6b34091.js"><link rel="prefetch" href="/core/assets/js/4.22891a47.js"><link rel="prefetch" href="/core/assets/js/5.09b6a9a4.js"><link rel="prefetch" href="/core/assets/js/6.2679362c.js"><link rel="prefetch" href="/core/assets/js/7.8eae3083.js"><link rel="prefetch" href="/core/assets/js/8.ad959692.js"><link rel="prefetch" href="/core/assets/js/9.d0585eea.js">
    <link rel="stylesheet" href="/core/assets/css/0.styles.9c038e3a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/core/" class="home-link router-link-active"><!----> <span class="site-name">Hitchy Manual</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/core/" class="nav-link">Home</a></div><div class="nav-item"><a href="/core/tutorials/" class="nav-link">Tutorials</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">API</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/core/api/index.html" class="nav-link">Hitchy's API</a></li><li class="dropdown-item"><!----> <a href="/core/api/plugins.html" class="nav-link">Plugin API</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Internals</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/core/internals/architecture-basics.html" class="nav-link">Architecture</a></li><li class="dropdown-item"><!----> <a href="/core/internals/components.html" class="nav-link">Components</a></li><li class="dropdown-item"><!----> <a href="/core/internals/plugin-integration.html" class="nav-link router-link-exact-active router-link-active">Plugins</a></li><li class="dropdown-item"><!----> <a href="/core/internals/routing-basics.html" class="nav-link">Routing</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Hitchy</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/core/" class="nav-link">Core</a></li><li class="dropdown-item"><!----> <a href="https://hitchyjs.github.io/plugin-odem/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Odem
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/hitchyjs/core" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/core/" class="nav-link">Home</a></div><div class="nav-item"><a href="/core/tutorials/" class="nav-link">Tutorials</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">API</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/core/api/index.html" class="nav-link">Hitchy's API</a></li><li class="dropdown-item"><!----> <a href="/core/api/plugins.html" class="nav-link">Plugin API</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Internals</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/core/internals/architecture-basics.html" class="nav-link">Architecture</a></li><li class="dropdown-item"><!----> <a href="/core/internals/components.html" class="nav-link">Components</a></li><li class="dropdown-item"><!----> <a href="/core/internals/plugin-integration.html" class="nav-link router-link-exact-active router-link-active">Plugins</a></li><li class="dropdown-item"><!----> <a href="/core/internals/routing-basics.html" class="nav-link">Routing</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Hitchy</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/core/" class="nav-link">Core</a></li><li class="dropdown-item"><!----> <a href="https://hitchyjs.github.io/plugin-odem/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Odem
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/hitchyjs/core" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Integrating Plugins</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/core/internals/plugin-integration.html#triangulation" class="sidebar-link">Triangulation</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/core/internals/plugin-integration.html#discovery" class="sidebar-link">Discovery</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/core/internals/plugin-integration.html#loading-plugin" class="sidebar-link">Loading Plugin</a></li><li class="sidebar-sub-header"><a href="/core/internals/plugin-integration.html#merging-meta-information" class="sidebar-link">Merging Meta Information</a></li><li class="sidebar-sub-header"><a href="/core/internals/plugin-integration.html#sorting-plugins" class="sidebar-link">Sorting Plugins</a></li><li class="sidebar-sub-header"><a href="/core/internals/plugin-integration.html#notify-plugin-on-discovery" class="sidebar-link">Notify Plugin on Discovery</a></li></ul></li><li><a href="/core/internals/plugin-integration.html#configuration" class="sidebar-link">Configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/core/internals/plugin-integration.html#collecting-compiling" class="sidebar-link">Collecting &amp; Compiling</a></li><li class="sidebar-sub-header"><a href="/core/internals/plugin-integration.html#final-notification" class="sidebar-link">Final Notification</a></li></ul></li><li><a href="/core/internals/plugin-integration.html#exposure" class="sidebar-link">Exposure</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/core/internals/plugin-integration.html#early-notification" class="sidebar-link">Early Notification</a></li><li class="sidebar-sub-header"><a href="/core/internals/plugin-integration.html#collecting-deriving-replacing" class="sidebar-link">Collecting, Deriving, Replacing</a></li><li class="sidebar-sub-header"><a href="/core/internals/plugin-integration.html#final-notification-2" class="sidebar-link">Final Notification</a></li></ul></li><li><a href="/core/internals/plugin-integration.html#initialisation" class="sidebar-link">Initialisation</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/core/internals/plugin-integration.html#routing" class="sidebar-link">Routing</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/core/internals/plugin-integration.html#shutdown" class="sidebar-link">Shutdown</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="integrating-plugins"><a href="#integrating-plugins" aria-hidden="true" class="header-anchor">#</a> Integrating Plugins</h1> <p>This topic is providing a brief description of Hitchy's bootstrap operation and the way it is discovering and integrating available plugins.</p> <p>On startup Hitchy is discovering available plugins and integrating them with the application. This process is tightly bound to <a href="/core/internals/architecture-basics.html#discovering-plugins">bootstrap stages</a>.</p> <h2 id="triangulation"><a href="#triangulation" aria-hidden="true" class="header-anchor">#</a> Triangulation</h2> <p>During triangulation phase there is no interaction with plugins for they haven't been discovered yet. It is mostly about Hitchy processing options customizing its behaviour and detecting an application's project folder as well its folder assumed to contain any available plugin.</p> <p>In triangulation Hitchy is qualifying some of the supported <a href="/core/api/#options">options</a>. And it tries to find base folder of project to be managed by Hitchy unless it has been given on invocation explicitly.</p> <div class="tip custom-block"><p class="custom-block-title">Finding Application Folder</p> <p>Unless providing application's project folder on invocation Hitchy is checking one of these supported use cases accepting the first one matching:</p> <ol><li><p>Hitchy assumes current working directory is project folder of application to be managed. The folder is accepted when containing sub-folder named <strong>node_modules</strong>. Otherwise parent folder of current working directory is tried. This process is repeated until either root folder of local file system has been reached or some folder containing <strong>node_modules</strong> has been found.</p></li> <li><p>Hitchy assumes to be installed as a dependency of its application or some dependency of a dependency of its application etc. In this case it is starting at its own folder assumed to be contained in a <strong>node_modules</strong> folder itself, thus testing its grandparent folder.</p></li></ol></div> <h2 id="discovery"><a href="#discovery" aria-hidden="true" class="header-anchor">#</a> Discovery</h2> <p>In discovery stage Hitchy is searching local filesystem for folders containing <strong>hitchy.json</strong> file. On every match the containing folder is considered an available Hitchy plugin. The <strong>hitchy.json</strong> file is read first providing static meta information on either plugin.</p> <div class="tip custom-block"><p class="custom-block-title">Folders Searched For Plugins</p> <p>By default, Hitchy is starting at application's folder. There it is deeply searching for any sub-folder in <strong>./node_modules</strong> containing a file named <strong>hitchy.json</strong>. It is ignoring folders marked as hidden by name with leading period.</p> <p>It is possible to explicitly select different folder to start from using option <strong>extensionFolder</strong>.</p> <p>Mostly for testing purposes it is possible provide a list of folders to be considered plugin folders explicitly using option <strong>explicitExtensions</strong>. It is also possible to prevent Hitchy from searching folder mentioned before by setting option <strong>explicitFoldersOnly</strong>. Neither option is supported by Hitchy's CLI script, though.</p></div> <h3 id="loading-plugin"><a href="#loading-plugin" aria-hidden="true" class="header-anchor">#</a> Loading Plugin</h3> <p>After detecting and loading an existing <strong>hitchy.json</strong> file the plugin's folder is loaded as a module using <code>require()</code> while supporting compliance with <a href="/core/api/#using-common-module-pattern">common module pattern</a>. A plugin should provide an <strong>index.js</strong> file exposing the plugin's API. It might <a href="https://docs.npmjs.com/files/package.json#main" target="_blank" rel="noopener noreferrer">select different filename<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, too.</p> <p>Whatever this file exports is considered the plugin's API.</p> <h3 id="merging-meta-information"><a href="#merging-meta-information" aria-hidden="true" class="header-anchor">#</a> Merging Meta Information</h3> <p>For every discovered plugin its (static) meta information read from <strong>hitchy.json</strong> file is merged with its (dynamic) meta information optionally provided in property <code>$meta</code> of plugin's API. The result is replacing the latter.</p> <div class="tip custom-block"><p class="custom-block-title">Static vs. Dynamic</p> <p>By relying on common module pattern a plugin is capable of computing information in API property <strong>$meta</strong>. That's why this is called <em>dynamic</em> meta information in opposition to the uncomputed, thus <em>static</em> meta information read from <strong>hitchy.json</strong> file.</p> <p>This option includes meta information like a plugin's role or its dependencies, thus allowing either plugin to pick a role or its dependencies dynamically.</p></div> <h3 id="sorting-plugins"><a href="#sorting-plugins" aria-hidden="true" class="header-anchor">#</a> Sorting Plugins</h3> <p>After compiling all discovered plugins' meta information Hitchy is capable of creating a dependency graph of those plugins and sort them accordingly from plugins many other plugins rely on to those ones no other plugin relies on.</p> <div class="tip custom-block"><p>Any follow-up action regarding <em>every plugin</em> is obeying this sorting order. In shutdown stage as well as in handling late policies the order is reversed.</p></div> <h3 id="notify-plugin-on-discovery"><a href="#notify-plugin-on-discovery" aria-hidden="true" class="header-anchor">#</a> Notify Plugin on Discovery</h3> <p>At the end of discovery stage every discovered plugin is notified on being discovered when exposing a method named <code>onDiscovered()</code> as part of its API.</p> <p>This notification comes early in a plugin's life cycle and thus it mustn't rely on too many context-related information available, yet. Either function is invoked with <code>this</code> referring to Hitchy's partially compiled API and Hitchy options, names of all discovered plugins and either plugin's handle as arguments.</p> <h2 id="configuration"><a href="#configuration" aria-hidden="true" class="header-anchor">#</a> Configuration</h2> <p>In configuration stage the application's configuration is compiled from every plugin and the application itself.</p> <h3 id="collecting-compiling"><a href="#collecting-compiling" aria-hidden="true" class="header-anchor">#</a> Collecting &amp; Compiling</h3> <p>Every plugin as well as the application is assumed to provide one or more configuration files with extension <strong>.js</strong> in sub-folder <strong>config</strong>. Hitchy is reading all those files merging them into a single configuration object which is exposed as part of Hitchy's API at <code>api.runtime.config</code>.</p> <h3 id="final-notification"><a href="#final-notification" aria-hidden="true" class="header-anchor">#</a> Final Notification</h3> <p>After having compiled this object every plugin is notified by invoking method <code>configure()</code> optionally available in either plugin's API. Either function is invoked with <code>this</code> referring to Hitchy's partially compiled API and Hitchy options as well as either plugin's handle as arguments.</p> <h2 id="exposure"><a href="#exposure" aria-hidden="true" class="header-anchor">#</a> Exposure</h2> <p>Exposure stage is meant to compile components listed in section <code>api.runtime</code> of Hitchy's API.</p> <h3 id="early-notification"><a href="#early-notification" aria-hidden="true" class="header-anchor">#</a> Early Notification</h3> <p>This stage starts with a notification called <code>onExposing()</code>. This notification is useful for accessing final configuration for the first time.</p> <p>Every interested plugin must export a method called <code>onExposing()</code> in its API. Just like before, the function is invoked with <code>this</code> referring to still partial Hitchy API and Hitchy options as well as either plugin's handle as arguments.</p> <h3 id="collecting-deriving-replacing"><a href="#collecting-deriving-replacing" aria-hidden="true" class="header-anchor">#</a> Collecting, Deriving, Replacing</h3> <p>After that, components of every plugin are loaded prior to loading those provided by current application.</p> <p>Found components are instantly exposed in Hitchy's API so that plugins as well as the application are able to see those components e.g. for deriving new components from those exposed by preceding plugins. In addition every plugin may replace previously exposed components by re-exposing another component with the same name.</p> <h3 id="final-notification-2"><a href="#final-notification-2" aria-hidden="true" class="header-anchor">#</a> Final Notification</h3> <p>Just like in previous stages a notification is dispatched by invoking method <code>onExposed()</code> for every plugin that's exporting this function as part of its API. Its signature is equivalent to that one of <code>onExposing()</code> described before.</p> <h2 id="initialisation"><a href="#initialisation" aria-hidden="true" class="header-anchor">#</a> Initialisation</h2> <p>In initialisation stage configuration and all components are available. Every plugin gets opportunity to initialise its state for runtime, e.g. by establishing connections to databases or similar.</p> <div class="tip custom-block"><p><a href="#shutdown">Shutdown stage</a> is supported as a counterpart to this stage.</p></div> <p>For every plugin a method <code>initialize()</code> exported as part of its API is invoked. The function is invoked with <code>this</code> referring to Hitchy's API and Hitchy options as well as either plugin's handle provided as arguments.</p> <p>Application may provide its initialisation code to be invoked after having initialised all plugins. Applications requiring special setup provide a file named <strong>initialize.js</strong> in project folder. This file is invoked in compliance with common module pattern.</p> <h2 id="routing"><a href="#routing" aria-hidden="true" class="header-anchor">#</a> Routing</h2> <p>In routing stage the routing definitions in configuration of every plugin are processed resulting in routes for later dispatch of request. Routes are read from configuration properties <code>routes</code>, <code>policies</code> and <code>blueprints</code>.</p> <p>After that application's configuration is processed accordingly for <code>routes</code> and <code>policies</code>.</p> <p>Routing definitions aren't replacing existing ones on match. For additional information on this rather complex method see the separate <a href="/core/internals/routing-basics.html">introduction on routing</a>.</p> <p>At the end of routing stage the application's bootstrap has finished.</p> <h2 id="shutdown"><a href="#shutdown" aria-hidden="true" class="header-anchor">#</a> Shutdown</h2> <p>When gracefully shutting down a Hitchy-based application every plugin gets a chance to shutdown its previously initialised state. The same applies to the application which gets a chance to do so first.</p> <p>On behalf of application a file named <strong>shutdown.js</strong> found in its project folder is loaded complying with common module pattern.</p> <p>After that for every plugin is checked for exporting a method <code>shutdown()</code> to be invoked now. Either function is invoked with <code>this</code> referring to Hitchy's API and Hitchy options as well as either plugin's handle provided as arguments.</p> <div class="tip custom-block"><p class="custom-block-title">Reversed Order</p> <p>In opposition to any preceding stage plugins are processed in reversed order so that plugins having initialised their state first are requested to shut it down last.</p></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/core/assets/js/app.3fcfb5e6.js" defer></script><script src="/core/assets/js/2.e41aa8d4.js" defer></script><script src="/core/assets/js/12.90e933a5.js" defer></script>
  </body>
</html>
