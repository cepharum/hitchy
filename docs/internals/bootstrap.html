<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Integrating Plugins | Hitchy Manual</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/core/assets/css/0.styles.8ba2ba71.css" as="style"><link rel="preload" href="/core/assets/js/app.c59c6f86.js" as="script"><link rel="preload" href="/core/assets/js/2.7e5cdbd9.js" as="script"><link rel="preload" href="/core/assets/js/14.39c4c251.js" as="script"><link rel="prefetch" href="/core/assets/js/10.2333f621.js"><link rel="prefetch" href="/core/assets/js/11.bd2618c5.js"><link rel="prefetch" href="/core/assets/js/12.52c81034.js"><link rel="prefetch" href="/core/assets/js/13.f774f336.js"><link rel="prefetch" href="/core/assets/js/15.6e226376.js"><link rel="prefetch" href="/core/assets/js/16.94c6531f.js"><link rel="prefetch" href="/core/assets/js/17.9e9d2ce4.js"><link rel="prefetch" href="/core/assets/js/18.50f66e84.js"><link rel="prefetch" href="/core/assets/js/19.0051027e.js"><link rel="prefetch" href="/core/assets/js/20.a4edaaed.js"><link rel="prefetch" href="/core/assets/js/21.43d3d262.js"><link rel="prefetch" href="/core/assets/js/3.64be540a.js"><link rel="prefetch" href="/core/assets/js/4.f090084f.js"><link rel="prefetch" href="/core/assets/js/5.330161fa.js"><link rel="prefetch" href="/core/assets/js/6.506a188b.js"><link rel="prefetch" href="/core/assets/js/7.0ea550cf.js"><link rel="prefetch" href="/core/assets/js/8.4a2ec393.js"><link rel="prefetch" href="/core/assets/js/9.7dc798dd.js">
    <link rel="stylesheet" href="/core/assets/css/0.styles.8ba2ba71.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/core/" class="home-link router-link-active"><!----> <span class="site-name">Hitchy Manual</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/core/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/core/tutorials/" class="nav-link">
  Tutorials
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API" class="dropdown-title"><span class="title">API</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/core/api/hitchy.html" class="nav-link">
  Hitchy's API
</a></li><li class="dropdown-item"><!----> <a href="/core/api/plugins.html" class="nav-link">
  Plugins API
</a></li><li class="dropdown-item"><!----> <a href="/core/api/components/" class="nav-link">
  Core Components
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Internals" class="dropdown-title"><span class="title">Internals</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/core/internals/architecture-basics.html" class="nav-link">
  Architecture
</a></li><li class="dropdown-item"><!----> <a href="/core/internals/components.html" class="nav-link">
  Components
</a></li><li class="dropdown-item"><!----> <a href="/core/internals/bootstrap.html" class="nav-link router-link-exact-active router-link-active">
  Plugins
</a></li><li class="dropdown-item"><!----> <a href="/core/internals/routing-basics.html" class="nav-link">
  Routing
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Hitchy" class="dropdown-title"><span class="title">Hitchy</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/core/" class="nav-link">
  Core
</a></li><li class="dropdown-item"><h4>
          
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://hitchyjs.github.io/plugin-odem/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Odem
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://hitchyjs.github.io/plugin-auth/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Auth
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div> <a href="https://github.com/hitchyjs/core" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/core/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/core/tutorials/" class="nav-link">
  Tutorials
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API" class="dropdown-title"><span class="title">API</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/core/api/hitchy.html" class="nav-link">
  Hitchy's API
</a></li><li class="dropdown-item"><!----> <a href="/core/api/plugins.html" class="nav-link">
  Plugins API
</a></li><li class="dropdown-item"><!----> <a href="/core/api/components/" class="nav-link">
  Core Components
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Internals" class="dropdown-title"><span class="title">Internals</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/core/internals/architecture-basics.html" class="nav-link">
  Architecture
</a></li><li class="dropdown-item"><!----> <a href="/core/internals/components.html" class="nav-link">
  Components
</a></li><li class="dropdown-item"><!----> <a href="/core/internals/bootstrap.html" class="nav-link router-link-exact-active router-link-active">
  Plugins
</a></li><li class="dropdown-item"><!----> <a href="/core/internals/routing-basics.html" class="nav-link">
  Routing
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Hitchy" class="dropdown-title"><span class="title">Hitchy</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/core/" class="nav-link">
  Core
</a></li><li class="dropdown-item"><h4>
          
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://hitchyjs.github.io/plugin-odem/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Odem
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://hitchyjs.github.io/plugin-auth/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Auth
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div> <a href="https://github.com/hitchyjs/core" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Integrating Plugins</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/core/internals/bootstrap.html#triangulation" class="sidebar-link">Triangulation</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/core/internals/bootstrap.html#discovery" class="sidebar-link">Discovery</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#finding-plugins" class="sidebar-link">Finding Plugins</a></li><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#loading-plugins" class="sidebar-link">Loading Plugins</a></li><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#validating-claimed-roles" class="sidebar-link">Validating Claimed Roles</a></li><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#a-plugin-s-handle" class="sidebar-link">A Plugin's Handle</a></li><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#notifying-plugins-on-discovery" class="sidebar-link">Notifying Plugins on Discovery</a></li><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#dropping-plugins" class="sidebar-link">Dropping Plugins</a></li><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#sorting-plugins" class="sidebar-link">Sorting Plugins</a></li></ul></li><li><a href="/core/internals/bootstrap.html#exposure" class="sidebar-link">Exposure</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#early-notification" class="sidebar-link">Early Notification</a></li><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#collecting-deriving-replacing" class="sidebar-link">Collecting, Deriving, Replacing</a></li><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#final-notification" class="sidebar-link">Final Notification</a></li></ul></li><li><a href="/core/internals/bootstrap.html#configuration" class="sidebar-link">Configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#collecting-compiling" class="sidebar-link">Collecting &amp; Compiling</a></li><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#final-notification-2" class="sidebar-link">Final Notification</a></li></ul></li><li><a href="/core/internals/bootstrap.html#initialisation" class="sidebar-link">Initialisation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#initialising-plugins" class="sidebar-link">Initialising Plugins</a></li><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#initialising-application" class="sidebar-link">Initialising Application</a></li></ul></li><li><a href="/core/internals/bootstrap.html#routing" class="sidebar-link">Routing</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/core/internals/bootstrap.html#shutdown" class="sidebar-link">Shutdown</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#shutting-down-application" class="sidebar-link">Shutting Down Application</a></li><li class="sidebar-sub-header"><a href="/core/internals/bootstrap.html#shutting-down-plugins" class="sidebar-link">Shutting Down Plugins</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="integrating-plugins"><a href="#integrating-plugins" class="header-anchor">#</a> Integrating Plugins</h1> <p>On startup Hitchy is discovering available plugins and integrating them with the application. This topic is providing a brief description of this so called <em>bootstrap operation</em> which is divided into several <a href="/core/internals/architecture-basics.html#discovering-plugins"><em>bootstrap stages</em></a>.</p> <h2 id="triangulation"><a href="#triangulation" class="header-anchor">#</a> Triangulation</h2> <p>During triangulation phase there is no interaction with plugins for they haven't been discovered yet. It is mostly about Hitchy processing options customizing its behaviour and detecting an application's project folder as well its folder assumed to contain any available plugin.</p> <p>In triangulation Hitchy is qualifying some of the supported <a href="/core/api/#options">options</a>. And it tries to find base folder of project to be managed by Hitchy unless it has been given on invocation explicitly.</p> <div class="custom-block tip"><p class="custom-block-title">Finding Application Folder</p> <p>Unless providing application's project folder on invocation Hitchy is checking one of these supported use cases accepting the first one matching:</p> <ol><li><p>Hitchy assumes current working directory is project folder of application to be managed. The folder is accepted when containing sub-folder named <strong>node_modules</strong>. Otherwise parent folder of current working directory is tried. This process is repeated until either root folder of local file system has been reached or some folder containing <strong>node_modules</strong> has been found.</p></li> <li><p>Hitchy assumes to be installed as a dependency of its application or some dependency of a dependency of its application etc. In this case it is starting at its own folder assumed to be contained in a <strong>node_modules</strong> folder itself, thus testing its grandparent folder.</p></li></ol></div> <h2 id="discovery"><a href="#discovery" class="header-anchor">#</a> Discovery</h2> <div class="custom-block warning"><p class="custom-block-title">Discovery Stage Is Crucial</p> <p>This stage is very important for finding all available plugins and settle any &quot;dispute&quot; when multiple available plugins claiming to take same role in resulting application.</p></div> <h3 id="finding-plugins"><a href="#finding-plugins" class="header-anchor">#</a> Finding Plugins</h3> <p>In discovery stage Hitchy is searching local filesystem for folders containing <strong>hitchy.json</strong> file. On every match the containing folder is considered an available Hitchy plugin. The <strong>hitchy.json</strong> file is read providing <em>static</em> meta information on either plugin.</p> <div class="custom-block tip"><p class="custom-block-title">Folders Searched For Plugins</p> <p>By default, Hitchy is starting at application's folder. There it is deeply searching for any sub-folder in <strong>./node_modules</strong> containing a file named <strong>hitchy.json</strong>. It is ignoring folders marked as hidden by name starting with a period.</p> <p>It is possible to explicitly select different folder to start searching as described before using option <a href="/core/api/#options-pluginsfolder"><strong>pluginsFolder</strong></a>.</p> <p>It is possible to provide an explicit list of folders containing plugins and their dependencies to be discovered using option <a href="/core/api/#options-explicitplugins-0-4-0"><strong>explicitPlugins</strong></a>. Plugins discovery can be limited to those explicitly provided plugins using option <a href="/core/api/#options-explicitpluginsonly-0-4-0"><strong>explicitPluginsOnly</strong></a>.</p></div> <h3 id="loading-plugins"><a href="#loading-plugins" class="header-anchor">#</a> Loading Plugins</h3> <p>For every plugin its folder is loaded as a module using <code>require()</code> while supporting compliance with <a href="/core/api/#using-common-module-pattern">common module pattern</a>. A plugin must provide an <strong>index.js</strong> file or <a href="https://docs.npmjs.com/files/package.json#main" target="_blank" rel="noopener noreferrer">select a different file<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to be actually loaded.</p> <p>The loaded module is considered the plugin's API.</p> <p>This API may include <em>dynamic</em> meta information in its property <code>$meta</code>. It is basically used to extend the plugin's static meta information. This extended meta information is replacing API's property <code>$meta</code> eventually.</p> <div class="custom-block warning"><p class="custom-block-title">Risks</p> <p>At this stage plugins are loaded in arbitrary order. Thus you can't rely on every other plugin's API being loaded already. You might need to cache available handle instead and wait for <code>onDiscovered()</code> notification described below.</p></div> <h3 id="validating-claimed-roles"><a href="#validating-claimed-roles" class="header-anchor">#</a> Validating Claimed Roles</h3> <p>Hitchy is passing additional information on loading a plugin which is complying with common module pattern. In addition to its highly rudimentary API provided as <code>this</code> and its <a href="/core/api/#options">options</a> provided in first argument it is passing</p> <ul><li>a dictionary mapping every basically discovered plugin's name into either one's rudimentary <a href="#a-plugin-s-handle">handle</a> in second argument and</li> <li>notified plugin's own handle in third argument.</li></ul> <p>Plugins may use this opportunity for dynamically claiming to take a role after inspecting available plugins. Whenever claiming to take a role dynamically every static claim for the same role is dropped probably resulting in plugins stripped off any role.</p> <div class="custom-block tip"><p class="custom-block-title">Example</p> <p>A plugin may be included to claim a role unless some other plugin is doing so. In this situation the former is meant to be a fallback for the latter.</p> <p>In a different scenario a plugin might detect another plugin it basically depends on for deriving from its API. The former plugin would claim same role as the latter one. This dynamic claim to take a role is replacing any plugin's static claim for the same role.</p></div> <h3 id="a-plugin-s-handle"><a href="#a-plugin-s-handle" class="header-anchor">#</a> A Plugin's Handle</h3> <p>Every plugin is exporting an API mostly used for integrating the plugin with a Hitchy-based application. It is thus essential in upcoming stages of bootstrap.</p> <p>During bootstrap every discovered plugin is additionally represented by another object which is internally known as <em>the plugin's handle</em>. Every handle comes with these properties:</p> <ul><li><code>handle.name</code> is providing the plugin's name.</li> <li><code>handle.staticRole</code> is providing the plugin's role claimed in its <strong>hitchy.json</strong> file.</li> <li><code>handle.folder</code> is providing the folder the plugin has been loaded from.</li> <li><code>handle.meta</code> is providing the plugin's loaded, merged and probably qualified meta information.</li> <li><code>handle.api</code> is finally providing the API exported by the plugin.</li> <li><code>handle.config</code> provides individual configuration of plugin read from its <strong>config</strong> folder in configuration stage.</li></ul> <h3 id="notifying-plugins-on-discovery"><a href="#notifying-plugins-on-discovery" class="header-anchor">#</a> Notifying Plugins on Discovery</h3> <p>Next, every plugin with an approved role which is exporting a method called <code>onDiscovered()</code> as part of its API gets notified on being discovered by invoking that function. This <em>notification handler</em> is assumed to comply with <a href="/core/api/#common-module-function-pattern">common module function pattern</a> and thus is invoked with <code>this</code> referring to Hitchy's still rudimentary API and with</p> <ul><li><a href="/core/api/#options">Hitchy's options</a>,</li> <li>a dictionary mapping either discovered plugin's name into its <a href="#a-plugins-handle">handle</a> and</li> <li>the <a href="#a-plugins-handle">handle</a> of current plugin exporting the notification handler</li></ul> <p>as function arguments.</p> <p>This notification is meant to provide APIs and meta information of all basically discovered plugins to those plugins with approved roles. The latter ones are assumed to cache references on APIs they intend to use prior to Hitchy dropping them.</p> <div class="custom-block warning"><p class="custom-block-title">Don't rely on sorting order!</p> <p>Plugins are notified in arbitrary order here. All succeeding notifications are processed in a certain order, though.</p></div> <h3 id="dropping-plugins"><a href="#dropping-plugins" class="header-anchor">#</a> Dropping Plugins</h3> <p>Next, plugins with their static roles dropped as described before are dropped. They won't make it into Hitchy's API and thus won't be available at runtime directly, but still might be used internally by some of the other plugins.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Even though explicitly selecting additional folders to contain plugins using option <a href="/core/api/#options-explicitplugins-0-4-0"><strong>explicitPlugins</strong></a> either of these plugins may be dropped for claiming a role neither application nor any of its plugins depend on. You may claim roles explicitly using option <a href="/core/api/#options-dependencies"><strong>dependencies</strong></a>.</p></div> <h3 id="sorting-plugins"><a href="#sorting-plugins" class="header-anchor">#</a> Sorting Plugins</h3> <p>For all leftover plugins a dependency graph is compiled. All plugins are sorted accordingly from plugin most other plugins rely on to those ones no other plugin relies on.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Any follow-up action regarding <em>every plugin</em> is obeying this sorting order now. In shutdown stage as well as in handling late policies this order is reversed.</p></div> <h2 id="exposure"><a href="#exposure" class="header-anchor">#</a> Exposure</h2> <div class="custom-block warning"><p class="custom-block-title">Compatibility</p> <p>Starting with version 0.4.0 this stage has swapped its position with <a href="#configuration">configuration stage</a>.</p></div> <p>Exposure stage is meant to compile and expose components in section <a href="/core/api/#api-runtime"><code>api.runtime</code> of Hitchy's API</a>.</p> <h3 id="early-notification"><a href="#early-notification" class="header-anchor">#</a> Early Notification</h3> <p>This stage starts with another notification called <a href="/core/api/plugins.html#plugin-onexposing"><code>onExposing()</code></a>. It is giving first opportunity to inspect the final list of actually available plugins as some of the initially discovered ones might have been replaced by <a href="/core/api/plugins.html#roles">others claiming the same role dynamically</a>.</p> <p>Every interested plugin must export a method called <code>onExposing()</code> as part of its API. Just like before, the function is invoked with <code>this</code> referring to still partial Hitchy API and Hitchy options as well as the notified plugin's handle as arguments.</p> <h3 id="collecting-deriving-replacing"><a href="#collecting-deriving-replacing" class="header-anchor">#</a> Collecting, Deriving, Replacing</h3> <p>Components of every plugin are processed before processing components of application.</p> <p>In either case components are processed <a href="/core/internals/architecture-basics.html#components">type</a> by type. For every component another Javascript file is expected in either type of component's sub-folder <strong>api/controllers</strong>, <strong>api/policies</strong> etc.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Starting with v0.3.3 Hitchy is deeply searching in either folder. Providing special meta information <a href="/core/api/plugins.html#deepcomponents-badge-0-4-0">per plugin</a> or <a href="/core/internals/components.html#exposure-at-runtime">application</a> the previous behaviour can be restored for either plugin or application.</p></div> <p>Every found Javascript file is loaded to export the component's API. This might be any kind of data. Usually, it is a class or an object of functions. It is exposed as part of <a href="/core/api/#api-runtime">Hitchy's API</a> at runtime using a <a href="/core/internals/components.html#derivation-of-component-names">name that is derived from found file's name</a>.</p> <p>Either component's module may comply with <a href="/core/api/#using-common-module-pattern">common module pattern</a>. In this case the exported  function is invoked with <code>this</code> referring to Hitchy's API in its current state and Hitchy's options in first argument as usual. In addition, however, some existing component of same name to be replaced by loaded one is passed in second argument so the new component is capable of deriving from that existing one.</p> <div class="custom-block tip"><p class="custom-block-title">Example</p> <p>Assume some plugin is providing same service module as another plugin it depends on. The module could look like this:</p> <p><strong>api/service/crypto.js:</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">options<span class="token punctuation">,</span> ExistingCryptoService</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">RevisedCryptoService</span> <span class="token keyword">extends</span> <span class="token class-name">ExistingCryptoService</span> <span class="token punctuation">{</span>
        <span class="token comment">// TODO provide some implementation here</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div> <h3 id="final-notification"><a href="#final-notification" class="header-anchor">#</a> Final Notification</h3> <p>Just like in previous stages a notification is dispatched by invoking method <code>onExposed()</code> for every plugin that's exporting this function as part of its API. Its signature is equivalent to that one of <code>onExposing()</code> described before.</p> <h2 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h2> <div class="custom-block warning"><p class="custom-block-title">Compatibility</p> <p>Starting with version 0.4.0 this stage has swapped its position with <a href="#exposure">exposure stage</a>.</p></div> <p>In configuration stage the application's configuration is compiled from every plugin and the application itself.</p> <h3 id="collecting-compiling"><a href="#collecting-compiling" class="header-anchor">#</a> Collecting &amp; Compiling</h3> <p>Every plugin as well as the application is assumed to provide zero or more non-hidden configuration files implemented as Javascript modules in sub-folder <strong>config</strong>. Every file in that sub-folder that does not start with a full stop <code>.</code> and ends with <strong>.js</strong> is assumed to export another part of eventual configuration.</p> <p>Hitchy is reading all those files merging them into a single configuration object which is exposed as part of Hitchy's API at <code>api.config</code>.</p> <div class="custom-block tip"><p class="custom-block-title">Special Case: local.js</p> <p>Every plugin as well as the application may use a file <strong>config/local.js</strong> which is always processed after having processed all the other configuration files in a folder. This helps with safely declaring defaults prior to providing a custom configuration for the current installation which might be deviating from those defaults.</p></div> <h3 id="final-notification-2"><a href="#final-notification-2" class="header-anchor">#</a> Final Notification</h3> <p>After having compiled this object every plugin is notified by invoking method <code>configure()</code> optionally available in either plugin's API. The function is invoked with <code>this</code> referring to Hitchy's partially compiled API and Hitchy options as well as the notified plugin's handle as arguments.</p> <h2 id="initialisation"><a href="#initialisation" class="header-anchor">#</a> Initialisation</h2> <p>In initialisation stage configuration and all components are available. Every plugin gets opportunity to initialise its state for runtime, e.g. by establishing connections to databases or similar.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><a href="#shutdown">Shutdown stage</a> is supported as a counterpart to this stage.</p></div> <h3 id="initialising-plugins"><a href="#initialising-plugins" class="header-anchor">#</a> Initialising Plugins</h3> <p>For every plugin a method <code>initialize()</code> exported as part of its API is invoked. The function is invoked with <code>this</code> referring to Hitchy's API and Hitchy options as well as either plugin's handle provided as arguments.</p> <h3 id="initialising-application"><a href="#initialising-application" class="header-anchor">#</a> Initialising Application</h3> <p>Application may provide its initialisation code to be invoked after having initialised all plugins. Applications requiring special setup provide a file named <strong>initialize.js</strong> in project folder. This file is invoked in compliance with common module pattern.</p> <p><strong>app/initialize.js</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">options</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">// TODO implement your application here, e.g. by setting up caches or similar</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="routing"><a href="#routing" class="header-anchor">#</a> Routing</h2> <div class="custom-block tip"><p class="custom-block-title">Dedicated Stage For Routing</p> <p>Routing stage is a dedicated stage at end of bootstrap so it is capable of using APIs, components and configuration of existing plugins and the application for eventually declaring routes.</p></div> <p>In routing stage every plugin is asked to provide its routing declarations in one of two ways:</p> <ol><li><p>Using configuration files just like the application either plugin can declare routing of <a href="/core/internals/routing-basics.html#policies"><code>policies</code></a>, (terminal) <a href="/core/internals/routing-basics.html#routes"><code>routes</code></a> and <a href="/core/internals/routing-basics.html#focusing-on-routes"><code>blueprints</code></a>.</p> <p>Those routings will be part of global configuration object exposed via Hitchy's API at runtime, as well. But either plugin's configuration as well as the routing configuration of application is processed independently.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This option has been introduced in v0.3.6.</p></div></li> <li><p>The preferred way is to expose either set of declarations as part of a <a href="/core/api/plugins.html#common-plugin-api">plugin's API</a>. <code>policies</code>, <code>routes</code> and/or <code>blueprints</code> can be exposed as object containing declarations or as function to be invoked in compliance with common module (function) pattern to return either set of declarations there.</p> <div class="custom-block tip"><p class="custom-block-title">Hidden Routings</p> <p>This approach is preferred to prevent useless pollution of <a href="/core/api/#configuration">configuration object</a>.</p></div></li></ol> <p>After that application's configuration is processed accordingly for <code>routes</code> and <code>policies</code>.</p> <p>Routing declarations aren't replacing existing ones on match, but might cause some declarations inferior to others to be dropped when optimising routing tables. For additional information on this rather complex method see the separate <a href="/core/internals/routing-basics.html">introduction on routing</a>.</p> <p>At the end of routing stage the application's bootstrap has finished.</p> <h2 id="shutdown"><a href="#shutdown" class="header-anchor">#</a> Shutdown</h2> <p>When gracefully shutting down a Hitchy-based application every plugin gets a chance to shutdown its previously initialised state. The same applies to the application which gets a chance to do so first.</p> <h3 id="shutting-down-application"><a href="#shutting-down-application" class="header-anchor">#</a> Shutting Down Application</h3> <p>On behalf of application a file named <strong>shutdown.js</strong> found in its project folder is loaded complying with common module pattern.</p> <p><strong>app/shutdown.js</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">options</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">// TODO remove caching files of your application or similar here</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="shutting-down-plugins"><a href="#shutting-down-plugins" class="header-anchor">#</a> Shutting Down Plugins</h3> <p>After that for every plugin is checked for exporting a method <code>shutdown()</code> to be invoked now. Either function is invoked with <code>this</code> referring to Hitchy's API and Hitchy options as well as either plugin's handle provided as arguments.</p> <div class="custom-block tip"><p class="custom-block-title">Reversed Order</p> <p>In opposition to any preceding stage plugins are processed in reversed order so that plugins having initialised their state first are requested to shut it down last.</p></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/core/assets/js/app.c59c6f86.js" defer></script><script src="/core/assets/js/2.7e5cdbd9.js" defer></script><script src="/core/assets/js/14.39c4c251.js" defer></script>
  </body>
</html>
